<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>图书列表</title>
        <meta name="referrer" content="no-referrer" />
		<link href="./css/bootstrap.min.css" rel="stylesheet" type="text/css" media="all">
        <link href="./css/fontawesome-all.min.css" rel="stylesheet" type="text/css" media="all">
        <link href="./css/blast.min.css" rel="stylesheet" />
        <link rel="stylesheet" type="text/css" href="css/style10.css" />
        <link href="./css/style.css" rel='stylesheet' type='text/css' media="all">
        <link href="http://fonts.googleapis.com/css?family=Montserrat:300,400,500" rel="stylesheet">
        <link href="http://fonts.googleapis.com/css?family=Merriweather:300,400,700,900" rel="stylesheet">
        <style>
        	a{
        		color: #000;
        	}
        	.model{
        		height: 100%;
        		width: 100%;
        		display: none;
        		background: rgba(0,0,0,0.5);
        		left: 0px;
        		top: 0px;
        		/*？？？？没有fixed显示不出来*/
        		position: fixed;        		
        	}
        	.model-content{
        		height:480px;
        		width:500px;
        		background: #fff;
        		margin: 50px auto;       		
        	}
        	.model-main{
        		align-content: center;
        		input{
        			width: 400px;
        		}
        	}
        	.btns{
        		margin-top:20px ;
        		display: flex;
        		justify-content: space-around;
        	}
        </style>
	</head>
	<body>
		<div class="container">
			
			<table class="table table-striped table-bordered table-hover table-responsive">
		    	<tr align="center">
		    		<th>编号</th>
		    		<th>书名</th>
		    		<th>作者</th>
		    		<th>类别</th>
		    		<th>简介</th>
		    		<th>出版社</th>
		    		<th>图书链接</th>
		    		<th>操作</th>
		    	</tr>			
		    	<% for(i=0;i<data.length;i++){%>
		    		<tr align="center">
		    			<td style="width: 70px;padding:0px"><%= data[i].bookid %></td>
		    			<td style="width: 150px;padding:0px"><%= data[i].bookname %></td>
		    			<td style="width: 120px;padding:0px"><%= data[i].author %></td>
		    			<td style="width: 120px;height:60px;overflow-x:scroll;padding:0px"><%= data[i].tag %></td>
		    			<td style="width: 400px;padding:0px"><p style="height:100px;overflow-y: scroll;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%= data[i].introsition %></p></td>
		    			<td style="width: 120px;padding:0px"><%= data[i].publish %></td>
		    			<td style="width: 100px;padding:0px"><img style="height:100px" src="<%= data[i].imgurl %>"/></td>					
		    			<td>
		    				<button class="btn btn-danger delete">删除</button>
		    				<hr />
		    				<button class="btn btn-info change">修改</button>
		    			</td>
		    		</tr>
		    	<%}%>	
		    	</table>
		    	<p>共有<%=number%>条</p>
				<div style="height:50px; line-height:20px; width:100%;overflow-x:scroll">
	                <div style="height:50px;line-height: 20px;width:20000px" align="center">
	                    <% for(n=1;n <= Math.ceil(number/10);n++){ %>
	                        <a href="/list?page=<%= n %>">第<%= n %>页</a>
	                    <% } %>
	                </div>			
				</div>

		    	<h1>添加数据</h1>		    	
	
		    	<table  class="table table-striped table-bordered table-hover table-responsive">
		    		<tr align="center">
		    			<th>编号</th>
		    			<th>书名</th>
		    			<th>作者</th>
		    			<th>类别</th>
		    			<th>简介</th>
		    			<th>出版社</th>
		    			<th>图书链接</th>
		    			<th>操作</th>
		    		</tr>
		    	    <tr style="padding: 0px;" align="center">
		    	    	<td style="height:60px;padding: 0px;padding-top:20px"><input style="width: 70px; " type="text" id="bookid"/></td>
		    	    	<td style="height:60px;padding: 0px;padding-top:20px"><input style="width: 130px;" type="text" id="bookname"/></td>
		    	    	<td style="height:60px;padding: 0px;padding-top:20px"><input style="width: 130px;" type="text" id="author"/></td>
		    	    	<td style="height:60px;padding: 0px;padding-top:20px"><input style="width: 70px; " type="text" id="tag"/></td>
		    	    	<td style="height:60px;padding: 0px;padding-top:20px"><input style="width: 320px;" type="text" id="introsition"/></td>
		    	    	<td style="height:60px;padding: 0px;padding-top:20px"><input style="width: 115px;" type="text" id="publish"/></td>
		    	    	<td style="height:60px;padding: 0px;padding-top:20px"><input style="width: 182px;" type="text" id="imgurl"/></td>
		    	    	<td><button type="button" class="btn btn-info" id="add">添加</button></td>
		    	    </tr>			
		       </table>   
	    </div>
	    <div class="model">
	    	<div class="model-content">
	    		<div class="model-main">
	    			<hr />
	    			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;书籍编号: <input id=Nbookid type="text">
	    			<hr />
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;书籍名称: <input id=Nbookname type="text">
                    <hr />   
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;书籍作者: <input id=Nauthor type="text">
                    <hr />
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;书籍简介: <input id=Nintrosition type="text">
                    <hr />                                        
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;书籍标签: <input id=Ntag type="text">
                    <hr />                                                            
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;出版社名: <input id=Npublish type="text">
                    <hr />                                                           
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;图片链接: <input id=Nimgurl type="text">
	    		</div>
	    		<div class="btns">
	    			<button type="button" class="btn btn-primary save">保存</button>
                    <button type="button" class="btn btn-success cancel">取消</button>
	    		</div>	    		
	    	</div>
	    </div>

	</body>
</html>

		<script src="./js/jquery-2.2.3.min.js"></script>
		<script src="./js/bootstrap.min.js"></script>
<script>
	$(function(){
		$('#add').click(function(){
			var bookdata='?bookid='+$('#bookid').val()+'&bookname='+$('#bookname').val()+'&author='+$('#author').val()+'&tag='+$('#tag').val()+'&introsition='+$('#introsition').val()+'&imgurl='+$('#imgurl').val()+'&publish='+$('#publish').val();    
			$.ajax({
				url:"http://localhost:3000/addbook"+bookdata,
				success:function(res){
					console.log(res);
				}
			})
		});
		
		$('.delete').click(function(){
			console.log($(this).parent('td').parent('tr').children('td').eq(0).html());
			var deletes=confirm('您确定要删除吗');
			if(deletes){
				$.ajax({
					url:'http://localhost:3000/removebook?bookid='+$(this).parent('td').parent('tr').children('td').eq(0).html(),
					success:function(res){
						console.log(res);
					}
				})
			}
		});
		
		$('.change').click(function(){
			//获取书的id
			$('#Nbookid').val($(this).parent('td').parent('tr').children('td').eq(0).html());
			$('#Nbookname').val($(this).parent('td').parent('tr').children('td').eq(1).html());
			$('#Nauthor').val($(this).parent('td').parent('tr').children('td').eq(2).html());
			$('#Ntag').val($(this).parent('td').parent('tr').children('td').eq(3).html());
			$('#Nintrosition').val($(this).parent('td').parent('tr').children('td').eq(4).children('p').html());	
			$('#Npublish').val($(this).parent('td').parent('tr').children('td').eq(5).html());
			$('#Nimgurl').val($(this).parent('td').parent('tr').children('td').eq(6).children('img').val());
														

			$('.model').css({
				'display':'block'
			});
			document.body.parentNode.style.overflow="hidden";
		});
		
		$('.cancel').click(function(){
			$('.model').css({
				'display':'none'
			});
			document.body.parentNode.style.overflow = "auto";
		});
		
		$('.save').click(function(){
			var bookdata='?bookid='+$('#Nbookid').val()+'&bookname='+$('#Nbookname').val()+'&author='+$('#Nauthor').val()+'&tag='+$('#Ntag').val()+'&introsition='+$('#Nintrosition').val()+'&imgurl='+$('#Nimgurl').val()+'&publish='+$('#Npublish').val();
			$.ajax({
				url:'http://localhost:3000/changebook'+bookdata,
				success:function(res){
					console.log(res);				
					window.location.reload();
				}
			});
			$('.model').css({
				'display':'none'
			});
			document.body.parentNode.style.overflow = "auto";
		})
	})
</script>